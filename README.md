<h1>Expamine alerts, logs and rules with Suricata  </h1>


<h2>Description</h2>
In thia lab I explored suricata alerts and logs, including the general process of rule creation.
 
The Suricata tool monitors network interfaces and applies rules to the packets that pass through the interface. Suricata determines whether each packet should generate an alert and be dropped, rejected, or allowed to pass through the interface.

Source and destination networks must be specified in the Suricata configuration. Custom rules can be written to specify which traffic should be processed.



<h2>Trigger a custom rule in Suricata  </h2>

<img src="https://github.com/Bridgetanntighe/Filter-SQL-II/assets/134883216/fdb13e1e-c6d7-4473-8f43-ee73cc2c3841" height="90%" width="90%" alt="Active Directory Lab"/><br>
Before running Suricata, there are no files in the <i>/var/log/suricata</i> directory. <br>
After starting the Suricata application and processes the <i>sample.pcap</i> file uses the rules in the <i>custom.rules</i> file. It returns an output stating how many packets were processed by Suricata.<br>
The <i>-r sample.pcap</i> option specifies an input file to mimic network traffic. In this case, the <i>sample.pcap</i> file.<br>
The <i>-S custom.rules</i> option instructs Suricata to use the rules defined in the <i>custom.rules</i> file.<br>
The <i>-k none</i> option instructs Suricata to disable all checksum checks.<br>
<b>Checksums</b> are a way to detect if a packet has been modified in transit. Because I used network traffic from a sample packet capture file, I won't need Suricata to check the integrity of the checksum.<br>
Suricata adds a new alert line to the <i>/var/log/suricata/fast.log</i> file when all the conditions in any of the rules are met.<br>
<br>
Below I then listed the files in the <i>/var/log/suricata</i> folder again:<br>
<img src="https://github.com/Bridgetanntighe/Filter-SQL-II/assets/134883216/debe8797-1b17-4aa0-bbff-f2e0d6f9e54f" height="60%" width="60%" alt="Active Directory Lab"/><br>
After running Suricata, there are now four files in the <i>/var/log/suricata</i> directory, including the <i>fast.log</i> and <i>eve.json</i> files.<br>
<br>
Lets examine these files in more detail:<br>
<img src="https://github.com/Bridgetanntighe/Filter-SQL-II/assets/134883216/7b9565ae-4d24-4a32-bf76-62973b24cb7b" height="90%" width="90%" alt="Active Directory Lab"/><br>
Each line or entry in the <i>fast.log</i> file corresponds to an alert generated by Suricata when it processes a packet that meets the conditions of an alert generating rule. Each alert line includes the message that identifies the rule that triggered the alert, as well as the source, destination, and direction of the traffic.<br>


<h2>Task 3. Examine eve.json output</h2>
In this task, I examined the additional output that Suricata generates in the <i>eve.json</i> file.<br>
As previously mentioned, this file is located in the <i>/var/log/suricata/</i> directory.<br>
(screenshot of cat)
1. Using the <i>cat</i>command to display the entries in the <i>eve.json</i>file:
<img src="https://github.com/Bridgetanntighe/FilterSQLTheory/assets/134883216/e240ad3a-0a09-4e60-9c7c-d67b512c4afe" height="80%" width="80%" alt="Active Directory Lab"/><br>
The output returns the raw content of the file. There is a lot of data returned and is not easy to understand in this format.<br>
2. I then used the <i>jq</i> command to display the entries in an improved format.<br>
(screenshot of this format)
<img src="https://github.com/Bridgetanntighe/FilterSQLTheory/assets/134883216/e240ad3a-0a09-4e60-9c7c-d67b512c4afe" height="80%" width="80%" alt="Active Directory Lab"/>
It is now much easier to read the output as opposed to the <i>cat</i> command output <br>
<b>Note:</b><i>The jq tool is very useful for processing JSON data, however, a full explanation of its capabilities is outside of the scope of this lab.<br></i>
It shows the value of the severity property for the first alert is 3.<br>
<br>
3. Press <b>Q</b> to exit the <i>less</i> command and to return to the command-line prompt.
(show screenshot of this)
<img src="https://github.com/Bridgetanntighe/FilterSQLTheory/assets/134883216/e240ad3a-0a09-4e60-9c7c-d67b512c4afe" height="80%" width="80%" alt="Active Directory Lab"/><br>

4.Below I used the <i>jq</i> command to extract specific data from the <i>eve.json</i>file:
<img src="https://github.com/Bridgetanntighe/FilterSQLTheory/assets/134883216/e240ad3a-0a09-4e60-9c7c-d67b512c4afe" height="80%" width="80%" alt="Active Directory Lab"/>
<b><i>Note:</b>: The jq command above extracts the fields specified in the list in the square brackets from the JSON payload. The fields selected are the timestamp (.timestamp), the flow id (.flow_id), the alert signature or msg (.alert.signature), the protocol (.proto), and the destination IP address (.dest_ip).</i> 
The destination IP address is 142.250.1.102.<br>
The first event in the eve.json file has "GET on WIRE" as the alert signature.<br>
<img src="https://github.com/Bridgetanntighe/FilterSQLTheory/assets/134883216/e240ad3a-0a09-4e60-9c7c-d67b512c4afe" height="80%" width="80%" alt="Active Directory Lab"/><br>
 
5. Use the jq command to display all event logs related to a specific flow_id from the eve.json file. The flow_id value is a 16-digit number and will vary for each of the log entries. Replace X with any of the flow_id values returned by the previous query:
<img src="https://github.com/Bridgetanntighe/FilterSQLTheory/assets/134883216/e240ad3a-0a09-4e60-9c7c-d67b512c4afe" height="80%" width="80%" alt="Active Directory Lab"/><br>

<b><i>Note:</b>A network flow refers to a sequence of packets between a source and destination that share common characteristics such as IP addresses, protocols, and more. In cybersecurity, network traffic flows help analysts understand the behavior of network traffic to identify and analyze threats. Suricata assigns a unique flow_id to each network flow. All logs from a network flow share the same flow_id. This makes the flow_id field a useful field for correlating network traffic that belongs to the same network flows.</i>


<h2>Conclusion</h2>
This filters to packets containing web requests made with the <i>curl</i> command in this sample packet capture file.
<img src="https://github.com/Bridgetanntighe/FilterSQLTheory/assets/134883216/bfec4b33-2cb7-44f4-9885-78f89ff4d444 height="80%" width="80%" alt="Active Directory Lab"/>
